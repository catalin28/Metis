Generate competitive dashboard with market perception analysis for {target_symbol}.

**Target Company**: {target_symbol}
**Peer Companies**: {peer_symbols}

**Raw Metrics Data**:
{metrics}

**Top 3 Strengths (PRE-CALCULATED - use these exact metrics)**:
{top_3_strengths}

**Top 3 Weaknesses (PRE-CALCULATED - use these exact metrics)**:
{top_3_weaknesses}

**Instructions**:
Analyze each metric to determine market perception and generate explanations for why the market perceives each metric the way it does.

**Market Perception Categories**:
- **Undervalued**: Strong performance but low valuation multiple
- **Underappreciated**: Top-tier metric but insufficient market recognition
- **Hidden strength**: Best-in-class metric with communication gap
- **Not communicated**: Advantage exists but not disclosed effectively
- **Adequate**: Performance and perception aligned
- **Overvalued**: Valuation exceeds fundamental support
- **Root cause**: Metric directly contributing to valuation discount

**For Each Metric, Provide**:

1. **Market Perception Classification**: Choose from categories above based on:
   - Metric rank vs peers (#1 = best performance)
   - Current P/E ratio vs peer average
   - Whether strong performance is rewarded with valuation premium
   - NOTE: For P/E ratio itself, #1 rank = cheapest valuation (best value), not highest performance

2. **Perception Explanation** (20-500 characters):
   - WHY the market perceives this metric this way
   - What drives the perception gap (if exists)
   - Impact on overall valuation
   - For P/E: Use "cheapest" not "best" (e.g., "trades at second-lowest P/E in peer set")
   - For Market Cap "Adequate" when overshadowed by much larger peer: Acknowledge scale dominance (e.g., "strong but overshadowed by PEER's scale, which moderates perceived differentiation")
   - CRITICAL VALUATION LANGUAGE:
     * If target P/E is ABOVE peer average: Use "premium" or "pressure on premium multiple" - NEVER say "valuation discount"
     * If target P/E is BELOW peer average: Use "discount" or "undervalued" - NEVER say "premium"
     * For negative revenue growth (QoQ) on premium stock: Say "QoQ revenue decline of X% puts pressure on the current premium multiple" NOT "contributes to valuation discount"
     * Always specify QoQ time horizon when mentioning revenue growth to prevent misinterpretation as annual weakness
     * For market cap perceptions on premium stocks: Qualify upside with "may depend on sustaining growth to justify existing premium"
     * Example (P/E above avg): "...puts pressure on the current premium multiple" NOT "contributes to valuation discount"

**Analysis Rules**:
- If target has #1 or #2 rank but lowest P/E → "Undervalued" or "Hidden strength"
- If target has worst rank and lowest P/E → "Root cause"  
- If metric is best but not widely discussed → "Not communicated"
- Focus on explaining valuation disconnect, not just describing the number

**Output Requirements**:
1. **metrics**: List of CompetitiveMetric objects (min 5, max 20) with:
   - metric_name, target_value, peer_values, target_rank, rank_qualifier (from input - COPY EXACTLY, DO NOT MODIFY)
   - market_perception: enum from categories above
   - perception_explanation: 20-500 char explanation of why this perception exists

2. **overall_target_rank**: COPY the pre-calculated value from input ({overall_target_rank}) - DO NOT recalculate

3. **key_strengths_summary**: 50-500 char summary using ONLY the top_3_strengths provided above
   - DO NOT choose different metrics - use the 3 pre-calculated strengths
   - Format: "{{Company}} leads in {{metric1}} (#{{rank}}, value), {{metric2}} (#{{rank}}, value), and {{metric3}} (#{{rank}}, value)"
   - Include actual values and ranks from the data

4. **key_weaknesses_summary**: 50-500 char summary using ONLY the top_3_weaknesses provided above
   - DO NOT choose different metrics - use the 3 pre-calculated weaknesses
   - Format: "{{Company}} trails in {{metric1}} (#{{rank}}, value), {{metric2}} (#{{rank}}, value), and {{metric3}} (#{{rank}}, value)"
   - MUST include actual values and ranks from the data (e.g., "P/E Ratio (#N, NN.NN), Revenue Growth QoQ (#N, -N.NN%)")
   - CRITICAL: Revenue growth is Quarter-over-Quarter (QoQ). Always label as "Revenue Growth (QoQ)" to clarify time horizon
   - **CRITICAL: If fewer than 3 weaknesses provided:**
     * DO NOT add "N/A (#N/A, N/A)" or placeholder text
     * Write summary using ONLY weaknesses actually provided
     * If 2 weaknesses: "{{Company}} trails in {{metric1}} (#{{rank}}, value) and {{metric2}} (#{{rank}}, value)"
     * If 1 weakness: "{{Company}}'s primary weakness is {{metric1}} (#{{rank}}, value)"
     * NEVER include "N/A" or meta-commentary about missing data
     * ALWAYS include specific values to meet 50-char minimum

**Example Analysis Format**:
Metric: [METRIC_NAME] = X.X, Rank #N, rank_qualifier="[qualifier]", Peers: [PEER_A]=Y.Y, [PEER_B]=Z.Z
- market_perception: "[category from list above]"  
- perception_explanation: "[Explanation of why market perceives this way, connecting rank to valuation and identifying communication/perception gaps]"

For P/E specifically:
Metric: P/E Ratio = X.Xx, Rank #N, rank_qualifier="Nth cheapest/most expensive", Peers: [values]
- market_perception: "[Use 'Premium vs peers' if trading above peer avg; 'Discount vs peers' if below; avoid 'Overvalued'/'Undervalued' unless extreme]"
- perception_explanation: "Trades at [lowest/highest/Nth] P/E ([above/below] peer average of X.Xx) due to [ROE premium/growth concerns/risk factors]. [Specific driver explanation]."

P/E INTERPRETATION NOTES:
- P/E rank_qualifier shows relative positioning ("3rd cheapest" = third-lowest P/E among peers)
- market_perception should reflect if premium/discount is JUSTIFIED by fundamentals
- "Premium vs peers" = trading above peer avg P/E (may be justified by superior ROE/growth)
- "Overvalued" = premium NOT justified by fundamentals (reserve for extreme cases)
- Be consistent: don't label "3rd cheapest" as "Overvalued" unless fundamentals are clearly weak

CRITICAL: 
- Copy metric_name, target_value, peer_values, target_rank, and rank_qualifier EXACTLY from input
- For P/E explanations, use language like "cheapest", "lowest valuation", "most discounted" (not "best P/E")
- Only generate market_perception and perception_explanation fields
- Do NOT calculate perception_gap_count - Python will auto-calculate it from your market_perception tags
